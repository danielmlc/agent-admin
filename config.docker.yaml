# agent-admin Docker 环境配置文件
# 此配置文件在 Docker 容器中使用，敏感信息通过环境变量注入

application:
  # 应用基础配置
  name: 'agent-admin'
  port: 3001
  env: 'production'
  host: '0.0.0.0'  # Docker 环境监听所有接口
  serverPath: 'api'

  # 日志配置
  logger:
    level: 'info'
    dir: './logs'
    appLogName: 'app-%DATE%.log'
    errorLogName: 'error-%DATE%.log'
    maxFiles: '30d'
  disableConsole: false

  httpClient:
    timeout: 5000

  # 中间件策略配置
  middlewareStrategy: true

  # CORS 配置 (生产环境建议配置具体的域名)
  cors:
    origin: true
    credentials: true

  # 上下文中间件配置
  contextMiddleware: true

  # 请求日志拦截器配置
  loggerInterceptor:
    moreInfo: false

  # 响应转换拦截器配置
  transformInterceptor: true

  # 管道策略配置
  pipesStrategy: true

  # 参数验证管道配置
  validationPipe:
    whitelist: false
    forbidNonWhitelisted: false
    skipMissingProperties: true
    skipNullProperties: true
    skipUndefinedProperties: false
    transform: true

  # 异常过滤器配置
  exceptionFilter:
    stack:
      response: false  # 生产环境不暴露堆栈信息
      logger: true

  docs:
    name: 'agent-admin'
    describe: '但以理控制面板文档'
    version: 1.0

  # 数据库配置 (从环境变量读取)
  database:
    type: 'better-sqlite3'
    database: '/app/data/database.sqlite'  # 容器内路径
    synchronize: false  # 生产环境关闭自动同步
    logging: false
    autoLoadEntities: true

  # JWT 配置 (从环境变量读取密钥)
  jwt:
    accessTokenSecret: '${JWT_ACCESS_SECRET}'
    accessTokenExpire: '2h'
    refreshTokenSecret: '${JWT_REFRESH_SECRET}'
    refreshTokenExpire: '7d'

  # Redis 配置 (Docker Compose 服务名)
  redis:
    host: '${REDIS_HOST:-redis}'
    port: 6379
    db: 0
    password: '${REDIS_PASSWORD}'

  # 短信配置 (从环境变量读取)
  sms:
    provider: '${SMS_PROVIDER:-aliyun}'
    accessKeyId: '${SMS_ACCESS_KEY_ID}'
    accessKeySecret: '${SMS_ACCESS_KEY_SECRET}'
    endpoint: 'dysmsapi.aliyuncs.com'
    signName: '${SMS_SIGN_NAME:-your-sign-name}'
    template:
      captcha:
        code: '${SMS_TEMPLATE_CODE:-SMS_xxxxxxx}'
        content: '您的验证码为：${code}，请勿泄露于他人！'

  # 第三方登录配置 (从环境变量读取)
  oauth:
    wechat:
      appId: '${WECHAT_APP_ID:-your-wechat-appid}'
      appSecret: '${WECHAT_APP_SECRET:-your-wechat-secret}'
      callbackUrl: '${WECHAT_CALLBACK_URL:-http://localhost:3001/api/auth/wechat/callback}'
    github:
      clientId: '${GITHUB_CLIENT_ID}'
      clientSecret: '${GITHUB_CLIENT_SECRET}'
      callbackUrl: '${GITHUB_CALLBACK_URL:-http://localhost:3001/api/auth/oauth/github/callback}'
      frontendCallbackUrl: '${GITHUB_FRONTEND_CALLBACK:-http://localhost:3001/login.html#/oauth-callback}'
      frontendLoginUrl: '${GITHUB_FRONTEND_LOGIN:-http://localhost:3001/login.html}'

  # 安全配置
  security:
    loginFailLimit: 5
    loginFailLockTime: 600
    smsCodeExpire: 300
    smsCodeInterval: 60
    smsDailyLimit: 5
    captchaExpire: 120
